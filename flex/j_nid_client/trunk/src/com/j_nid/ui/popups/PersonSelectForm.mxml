<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml"
	title="ค้นหาลูกค้า" horizontalAlign="center"
	showCloseButton="true" close="close()"
	width="400"	height="500">
	
	<mx:Script>
		<![CDATA[
			import com.j_nid.utils.Utils;
			
			import mx.collections.ArrayCollection;
			import mx.collections.XMLListCollection;
			import mx.collections.Sort;
			import mx.controls.TileList;
			import mx.events.FlexEvent;
			import mx.events.ListEvent;
			import mx.utils.ArrayUtil;
			
			private var _people:XMLListCollection;
			[Bindable]
			private var _firstChars:ArrayCollection;
			public var selectedPerson:XML;
            
            private function close():void {
                Utils.hidePopUp(this);
            }
			
			private function charListChangeHandler(e:ListEvent):void {
				var tileList:TileList = TileList(e.currentTarget);
				people.filterFunction = filterFunction;
				people.refresh();
				personList.scrollToIndex(0);
			}
			
			private function filterFunction(person:XML):Boolean {
				return person.name.charAt(0) == firstCharList.selectedItem;
			}
			
			private function personListDoubleClick(e:MouseEvent):void {
				var tileList:TileList = TileList(e.currentTarget);
				selectedPerson = XML(tileList.selectedItem);
				close();
			}
			
			[Bindable]
			public function set people(obj:XMLListCollection):void {
				_people = obj;
				var objs:Object = {};
	            for each (var person:XML in _people) {
	                objs[person.name.charAt(0)] = 1;
	            }
	            _firstChars = new ArrayCollection();
	            for (var char:String in objs) {
	                _firstChars.addItem(char);
	            }
	            _firstChars.sort = new Sort();
	            _firstChars.refresh();
	        }
	        
	        public function get people():XMLListCollection {
	        	return _people;
	        }
		]]>
	</mx:Script>
	
	<mx:TileList id="firstCharList"
		dataProvider="{_firstChars}" columnCount="8"
		columnWidth="35" rowHeight="35" borderStyle="none"
		change="charListChangeHandler(event)"
		itemRenderer="com.j_nid.ui.renderers.FirstCharRenderer"/>
	
	<mx:TileList id="personList"
		dataProvider="{people}"	labelField="name" textAlign="left"
		columnCount="2" columnWidth="150" doubleClickEnabled="true"
		doubleClick="personListDoubleClick(event)"
		width="100%" height="100%"/>
</mx:TitleWindow>
