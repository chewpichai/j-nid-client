<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow
	title="Product Type Form"
	xmlns:mx="http://www.adobe.com/2006/mxml"
	creationComplete="init(event)"
	layout="absolute">
	
	<mx:Script>
		<![CDATA[
			import mx.events.ValidationResultEvent;
			import mx.controls.LinkButton;
			import mx.controls.Button;
			import com.j_nid.models.JNidModelLocator;
			import com.j_nid.controls.EventNames;
			import com.j_nid.utils.CairngormUtils;
			import com.j_nid.models.Product;
			import com.j_nid.models.ProductType;
			import mx.managers.PopUpManager;
			import mx.events.FlexEvent;
			
			[Bindable]
			private var model:JNidModelLocator = JNidModelLocator.getInstance();
			[Bindable]
			public var productType:ProductType;
			private var closeBtn:LinkButton;
			
			private function init(e:FlexEvent):void {
				PopUpManager.centerPopUp(this);
			}
			
			override protected function createChildren():void {
				super.createChildren();
				closeBtn = new LinkButton();
				closeBtn.label = "x";
				closeBtn.addEventListener(MouseEvent.CLICK, closeBtnClick);
				rawChildren.addChild(closeBtn);
			}
			
			override protected function updateDisplayList(unscaledWidth:Number, unscaledHeight:Number):void	{
				super.updateDisplayList(unscaledWidth, unscaledHeight);	
				var margin:int = 4;	
				var pixelsFromTop:int = 5;
				var pixelsFromRight:int = 10;
				closeBtn.setActualSize(30 + margin, 20 + margin);
				var buttonWidth:int = closeBtn.width;
				var xPos:int = unscaledWidth - buttonWidth - pixelsFromRight;
				var yPos:int = pixelsFromTop;
				closeBtn.move(xPos, yPos);
			}
			
			private function saveProductTypeListener(e:MouseEvent):void {
				if (isProductTypeValid()) {
					var type:ProductType = new ProductType();
					type.name = nameField.text;
					type.color = colorField.selectedColor;
					CairngormUtils.dispatchEvent(EventNames.CREATE_PRODUCT_TYPE, type);
				}
			}
			
			private function isProductTypeValid():Boolean {
				var validationResult:ValidationResultEvent = nameValidator.validate();
				return validationResult.type == ValidationResultEvent.VALID;
			}
			
			private function closeBtnClick(e:MouseEvent):void {
				PopUpManager.removePopUp(this);
			}
		]]>
	</mx:Script>
	
	<mx:Form
		width="100%" height="100%">
		
		<mx:FormItem label="Name" required="true">
			<mx:TextInput id="nameField"
				width="160" height="30"/>
		</mx:FormItem>
		
		<mx:FormItem label="Color">
			<mx:ColorPicker id="colorField"/>
		</mx:FormItem>
		
		<mx:FormItem>
			<mx:Button id="saveBtn"
				label="Save"
				click="saveProductTypeListener(event)"/>
		</mx:FormItem>
	</mx:Form>
	
	<mx:StringValidator id="nameValidator"
		source="{nameField}" property="text"
		trigger="{saveBtn}" triggerEvent="click"
		required="true"/>
</mx:TitleWindow>
