<?xml version="1.0" encoding="utf-8"?>
<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml" 
    xmlns:jn="com.j_nid.components.mxml.*"
    show="showHandler(event)"
    width="100%"
    height="100%">
    
    <mx:Metadata>
        [ResourceBundle("MakeSupply")]
    </mx:Metadata>
    
     <mx:Script>
        <![CDATA[
            import com.j_nid.models.Person;
            import com.j_nid.utils.Utils;
            import com.j_nid.models.Supply;
            import com.j_nid.models.SupplyItem;
            import mx.resources.ResourceBundle;
            import mx.rpc.events.ResultEvent;
            import mx.events.ListEvent;
            import mx.containers.ViewStack;
            import mx.events.IndexChangedEvent;
            import com.j_nid.models.Product;
            import mx.collections.ArrayCollection;
            import com.j_nid.models.ProductType;
            import mx.events.FlexEvent;
            
            [Bindable]
            private var supplyItems:ArrayCollection;
            
            private function showHandler(e:FlexEvent):void {
                productTypeList.dataProvider = ProductType.all();
                setSuppliers();
                supplyDetail.supply = new Supply();
                supplyItems = new ArrayCollection();
                supplyDetail.supplierFiled.typedText = "";
                validateNow();
            }
            
            private function setSuppliers():void {
                var suppliers:Array = Person.getSupplies();
                supplyDetail.suppliers = suppliers;
            }
            
            private function productDoubleClick(e:MouseEvent):void {
                var product:Product = Product(productList.selectedItem);
                supplyDetail.addSupplyItem(product);
            }
            
            private function formatPrice(item:Object,
                                         column:DataGridColumn):String {
                                            
                return Utils.formatPrice(item[column.dataField]);
            }
        ]]>
    </mx:Script>
    
    <mx:HBox
    	height="100%">
        
        <mx:Panel
            title="{resourceManager.getString('MakeSupply', 'ProductType')}"
            width="220"
            height="100%">
            
            <mx:List id="productTypeList" 
                labelField="name" 
                borderStyle="none"
                width="100%"
                height="100%"/>
        </mx:Panel>
        
        <mx:Panel
        	title="{resourceManager.getString('MakeSupply', 'Product')}"
            width="350"
            height="100%">
            
            <mx:DataGrid id="productList" 
                dataProvider="{productTypeList.selectedItem.products}"
                variableRowHeight="true"
                dragEnabled="true"
                doubleClickEnabled="true"
                doubleClick="productDoubleClick(event)"
                headerStyleName="centerHeader"
                width="100%"
                height="100%">
                
                <mx:columns>
                    <mx:DataGridColumn 
                        headerText="{resourceManager.getString(
                                          'MakeSupply', 'Name')}" 
                        dataField="name" 
                        wordWrap="true"/>
                    
                    <mx:DataGridColumn 
                        headerText="{resourceManager.getString(
                                          'MakeSupply', 'Unit')}" 
                        dataField="unit"
                        width="50"/>
                    
                    <mx:DataGridColumn 
                        headerText="{resourceManager.getString(
                                          'MakeSupply', 'PricePerUnit')}" 
                        dataField="costPerUnit"
                        labelFunction="formatPrice"
                        width="90"/>
                </mx:columns>
            </mx:DataGrid>
        </mx:Panel>
    </mx:HBox>
    
    <jn:SupplyDetail id="supplyDetail"
        supplyItems="{supplyItems}"
        width="100%"
        height="100%"/>
</mx:HBox>
