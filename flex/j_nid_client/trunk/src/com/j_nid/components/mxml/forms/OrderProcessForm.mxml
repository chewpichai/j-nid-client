<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow 
	title="{resourceManager.getString('OrderPage', 'Detail')}" 
	xmlns:mx="http://www.adobe.com/2006/mxml" 
	xmlns:adobe="http://www.adobe.com/2006/fc" 
	xmlns:jn="com.j_nid.components.mxml.*"
	layout="vertical" 
	creationComplete="init(event)"
	borderAlpha="0.8"
	verticalScrollPolicy="off"
	width="800"
	height="600">
	
	<mx:Metadata>
		[ResourceBundle("OrderPage")]
	</mx:Metadata>
	
	<mx:Script>
		<![CDATA[
			import com.j_nid.utils.Utils;
			import mx.resources.ResourceBundle;
			import com.j_nid.events.JNidEvent;
			import com.j_nid.utils.CairngormUtils;
			import mx.rpc.events.ResultEvent;
			import com.j_nid.models.Person;
			import mx.controls.Alert;
			import com.j_nid.models.Order;
			import mx.events.FlexEvent;
			
			[Bindable]
			public var order:Order;
			private var formatPrice:Function = Utils.formatPrice;
			
			private function init(e:FlexEvent):void {
				
			}
			
			private function submitBtnClickListener(e:MouseEvent):void {
			    order.addEventListener(JNidEvent.ORDER_CREATED, orderCreated);
			    order.paidTotal = payAmountField.value;
				order.save();
			}
			
			private function cancelBtnClickListener(e:MouseEvent):void {
				close();
			}
			
			private function orderCreated(e:JNidEvent):void {
				close();
			}
			
			private function close():void {
				CairngormUtils.dispatchEvent(JNidEvent.CLOSE_POPUP, this);
			}
			
			private function formatPriceGrid(item:Object,
                                             column:DataGridColumn):String {
                                            
                return formatPrice(item[column.dataField]);
            }
		]]>
	</mx:Script>
	
	<mx:DateFormatter id="dateFormatter"
    	formatString="DD-MM-YYYY JJ:NN:SS"/>
	
	<mx:HBox
	    width="100%">
		
		<mx:Label
		    text="{resourceManager.getString('OrderPage', 'Customer')}:"/>
		
		<mx:Label
		    text="{order.person.name}"/>
		
		<mx:Spacer
		    width="100%"/>
		
		<mx:Label
		    text="{resourceManager.getString('OrderPage', 'Date')}:"/>
		
		<mx:Label
		    text="{dateFormatter.format(order.created)}"/>
	</mx:HBox>
	
	<mx:DataGrid id="orderItemList"
		dataProvider="{order.orderItems}"
		wordWrap="true"
		variableRowHeight="true"
		headerStyleName="centerHeader"
		width="100%"
		height="100%">
		
		<mx:columns>
			<mx:DataGridColumn
				headerText="{resourceManager.getString('OrderPage', 'Quantity')}" 
				dataField="quantity"
				width="70"/>
			
			<mx:DataGridColumn
				headerText="{resourceManager.getString('OrderPage', 'Name')}" 
				dataField="name"/>
			
			<mx:DataGridColumn
				headerText="{resourceManager.getString('OrderPage', 'Unit')}" 
				dataField="unit"
				width="70"/>
			
			<mx:DataGridColumn
				headerText="{resourceManager.getString(
				                    'OrderPage', 'PricePerUnit')}" 
				dataField="pricePerUnit"
				labelFunction="formatPriceGrid"
				width="85"/>
			
			<mx:DataGridColumn
				headerText="{resourceManager.getString('OrderPage', 'Total')}"
				dataField="total"
				labelFunction="formatPriceGrid"
				width="85"/>
		</mx:columns>
	</mx:DataGrid>
	
	<mx:HBox
	    width="100%">
		
		<mx:Label
		    text="{resourceManager.getString('OrderPage', 'Note')}:"/>
		
		<mx:Text
		    text="{order.notation}"
		    width="100%"/>
	</mx:HBox>
	
	<mx:HBox
	    width="100%"
	    horizontalAlign="right">
	    
        <mx:Label
            text="{resourceManager.getString('OrderPage', 'QuantityTotal',
                          [order.quantityTotal])}"/>
    	
    	<mx:Label
    		text="{resourceManager.getString('OrderPage', 'Summary',
    		              [formatPrice(order.total), 0])}" 
    		textAlign="right"/>
	</mx:HBox>
	
	<mx:HBox
	    width="100%"
	    horizontalAlign="right">
	    
	    <mx:FormItem
	        label="{resourceManager.getString('OrderPage', 'PayAmount')}:">
	        
	        <mx:NumericStepper id="payAmountField"
	            value="{order.paidTotal}"
                minimum="0"
                maximum="{order.total}"
                stepSize="0.25"
                width="100"/>
	    </mx:FormItem>
	</mx:HBox>
	
	<mx:ControlBar id="mainControlBar"
		horizontalAlign="right">
		
		<mx:Button id="submitBtn"
			label="{resourceManager.getString('OrderPage', 'Submit')}"
			click="submitBtnClickListener(event)"/>
		
		<mx:Button id="cancelBtn"
			label="{resourceManager.getString('OrderPage', 'Cancel')}"
			click="cancelBtnClickListener(event)"/>
	</mx:ControlBar>
</mx:TitleWindow>
