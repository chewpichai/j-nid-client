<?xml version="1.0"?>
<!-- Custom control to print the DataGrid control on multiple pages. -->
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
    xmlns:jn="com.j_nid.components.mxml.prints.*"
    backgroundColor="#FFFFFF">
    
    <mx:Metadata>
        [ResourceBundle("OrderPrint")]
    </mx:Metadata>

    <mx:Script>
        <![CDATA[
            import com.j_nid.utils.Utils;
            import com.j_nid.models.Order;
            import mx.resources.ResourceBundle;
            // Declare and initialize the variables used in the component.
            // The application sets the actual prodTotal value.
            [Bindable]
            public var pageNumber:Number = 1;
            [Bindable]
            public var order:Order;

            // Control the page contents by selectively hiding the header and
            // footer based on the page type.
            public function showPage(pageType:String):void {
                if(pageType == "first" || pageType == "middle") {
                    // Hide the footer.
                    footer.includeInLayout = false;
                    footer.visible = false;
                }
                if(pageType == "middle" || pageType == "last") {
                    // The header won't be used again; hide it.
                    header.includeInLayout = false;
                    header.visible = false;
                }
                if(pageType == "last") {
                    // Show the footer.
                    footer.includeInLayout = true;
                    footer.visible = true;
                }
                //Update the DataGrid layout to reflect the results.
                validateNow();
            }
            
            private function formatPrice(item:Object,
                                         column:DataGridColumn):String {
                                          	
                return Utils.formatPrice(item[column.dataField]);
            }
        ]]>
    </mx:Script>

    <!-- The template for the printed page, with the contents for all pages. -->
    <mx:VBox
    	horizontalAlign="left" 
        x="0"
        y="0"
        width="100%">
        
        <mx:Label text="{resourceManager.getString('OrderPrint', 'OrderNo',
                            [order.id, pageNumber])}"/>
    </mx:VBox>

    <jn:OrderPrintHeader id="header" 
        personName="{order.person.name}"
        date="{order.created}"
        horizontalCenter="0" 
        top="30"
        width="100%"/>
    
    <!-- The data grid. The sizeToPage property is true by default, so the last
        page has only as many grid rows as are needed for the data. -->
    <mx:PrintDataGrid id="orderItemList"
        dataProvider="{order.orderItems}"
        styleName="printDataGrid"
        top="60"
        horizontalCenter="0"
        width="95%"
        height="100%">
        
        <!-- Specify the columns to ensure that their order is correct. -->
        <mx:columns>
            <mx:DataGridColumn
                headerText="{resourceManager.getString('OrderPrint',
                                    'Quantity')}"
                dataField="quantity"
                width="50"/>
            
            <mx:DataGridColumn
                headerText="{resourceManager.getString('OrderPrint', 'Name')}"
                dataField="name"/>
            
            <mx:DataGridColumn
                headerText="{resourceManager.getString('OrderPrint', 'Unit')}"
                dataField="unit"
                width="50"/>
            
            <mx:DataGridColumn
                headerText="{resourceManager.getString('OrderPrint',
                                    'PricePerUnit')}"
                dataField="pricePerUnit"
                labelFunction="formatPrice"
                width="85"/>
            
            <mx:DataGridColumn
                headerText="{resourceManager.getString('OrderPrint',
                                    'Subtotal')}"
                dataField="total"
                labelFunction="formatPrice"
                width="85"/>
        </mx:columns>
    </mx:PrintDataGrid>

    <!-- Create a FormPrintFooter control and set its prodTotal variable. -->
    <jn:OrderPrintFooter id="footer" 
        total="{order.total}"
        width="100%" 
        bottom="0"/>
</mx:Canvas>