<?xml version="1.0"?>
<!-- Custom control to print the DataGrid control on multiple pages. -->
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:print="com.j_nid.components.mxml.prints.*"
	backgroundColor="#FFFFFF">
	
	<mx:Metadata>
		[ResourceBundle("PaymentsPrint")]
	</mx:Metadata>

    <mx:Script>
        <![CDATA[
        	import com.j_nid.models.Payment;
        	import com.j_nid.utils.Utils;
        	import com.j_nid.models.Person;
        	import mx.resources.ResourceBundle;
            // Declare and initialize the variables used in the component.
            // The application sets the actual prodTotal value.
            private var _person:Person;
            private var payments:Array;
            [Bindable]
            public var startDate:Date;
            [Bindable]
            public var endDate:Date;
            [Bindable]
            public var total:Number;
            [Bindable]
            public var outstandingTotal:Number;
            private var utils:Utils = Utils.getInstance();
            
            public function set person(obj:Person):void {
            	_person = obj;
            	var lastDate:Date = utils.moveDateByDay(endDate, 1);
            	payments = new Array();
            	total = 0;
            	for each (var payment:* in person.payments) {
            		if (payment.created > startDate &&
            		    payment.created < lastDate) {
            			
            			payments.push(payment);
            			total += payment.amount;
            		}
            	}
            	paymentList.dataProvider = payments;
            }
            
            public function get person():Person {
            	return _person;
            }

            // Control the page contents by selectively hiding the header and
            // footer based on the page type.
            public function showPage(pageType:String):void {
                if(pageType == "first" || pageType == "middle") {
                    // Hide the footer.
                    footer.includeInLayout = false;
                    footer.visible = false;
                }
                if(pageType == "middle" || pageType == "last") {
                    // The header won't be used again; hide it.
                    header.includeInLayout = false;
                    header.visible = false;
                }
                if(pageType == "last") {
                    // Show the footer.
                    footer.includeInLayout = true;
                    footer.visible = true;
                }
                //Update the DataGrid layout to reflect the results.
                validateNow();
            }
            
            private function formatPrice(item:Object,
            							 column:DataGridColumn):String {
            							  	
            	return utils.formatPrice(item[column.dataField]);
            }
            
            private function formatDate(item:Object,
                                        column:DataGridColumn):String {
                                            
                return utils.formatDate(item[column.dataField], "DD-MM-YYYY");
            }
        ]]>
    </mx:Script>

    <print:PaymentsPrintHeader id="header" 
    	startDate="{startDate}"
    	endDate="{endDate}"
    	horizontalCenter="0" 
    	top="30"
    	width="100%"/>
    
    <!-- The data grid. The sizeToPage property is true by default, so the last
         page has only as many grid rows as are needed for the data. -->
    <mx:PrintDataGrid id="paymentList"
    	styleName="printDataGrid"
    	horizontalCenter="0"
    	top="60"
    	width="95%"
    	height="100%">
        
        <!-- Specify the columns to ensure that their order is correct. -->
        <mx:columns>
			<mx:DataGridColumn
				headerText="{resourceManager.getString('PaymentsPrint',
				                'Date')}"
				dataField="created"
				labelFunction="formatDate"/>
			<mx:DataGridColumn
				headerText="{resourceManager.getString('PaymentsPrint',
				                'Amount')}"
				dataField="amount"
				labelFunction="formatPrice"/>
		</mx:columns>
    </mx:PrintDataGrid>

    <!-- Create a FormPrintFooter control and set its prodTotal variable. -->
    <print:PaymentsPrintFooter id="footer"
    	total="{total}"
    	outstandingTotal="{outstandingTotal - total}"
    	width="100%" 
    	bottom="0"/>
</mx:Canvas>