<?xml version="1.0" encoding="utf-8"?>
<mx:WindowedApplication
    xmlns:mx="http://www.adobe.com/2006/mxml"
    xmlns:jn="com.j_nid.components.mxml.*" 
    xmlns:control="com.j_nid.controls.*"
    layout="vertical" 
    initialize="init(event)"
    applicationComplete="applicationComplete(event)"
    paddingBottom="0"
    verticalScrollPolicy="off"
    horizontalScrollPolicy="off"
    statusTextStyleName="copyright"
    status="Copyright (c) 2008-{currentYear} ChewLab. All rights reserved.">
    
    <mx:Style source="css/styles.css"/>
    
    <mx:Metadata>
        [ResourceBundle("MainMenu")]
    </mx:Metadata>
    
    <mx:Script>
        <![CDATA[
            import com.j_nid.events.JNidEvent;
            import com.j_nid.utils.CairngormUtils;
            import mx.events.FlexEvent;
            import mx.resources.ResourceBundle;
            
            [Bindable]
            private var currentYear:Number = new Date().fullYear;
            
            private function init(e:FlexEvent):void {
                
            }
            
            private function applicationComplete(e:FlexEvent):void {
                stage.nativeWindow.maximize();
            }
            
            private function logOutBtnClick(e:MouseEvent):void {
            	CairngormUtils.dispatchEvent(JNidEvent.LOG_OUT);
            }
        ]]>
    </mx:Script>
    
    <mx:states>
        <mx:State name="main">
            
            <mx:RemoveChild
            	target="{loginPage}"/>
            
            <mx:AddChild
            	position="lastChild">
                
                <mx:target>
                    <mx:ViewStack id="mainView"
                        creationPolicy="all"
                        width="100%"
                        height="100%">
                        
                        <jn:MainPage id="mainPage"
                            label="{resourceManager.getString(
                                        'MainMenu', 'Main')}"
                            showEffect="{fadeIn}"
                            hideEffect="{fadeOut}"/>
                        
                        <jn:MakeOrderPage id="sellPage"
                            label="{resourceManager.getString(
                                        'MainMenu', 'MakeOrder')}"
                            showEffect="{fadeIn}"
                            hideEffect="{fadeOut}"/>
                        
                        <jn:MakeSupplyPage id="buyPage"
                            label="{resourceManager.getString(
                                        'MainMenu', 'MakeSupply')}"
                            showEffect="{fadeIn}"
                            hideEffect="{fadeOut}"/>
                        
                        <jn:ProductPage id="productPage"
                            label="{resourceManager.getString(
                                        'MainMenu', 'Product')}"
                            showEffect="{fadeIn}"
                            hideEffect="{fadeOut}" />
                        
                        <jn:PersonPage id="personPage"
                            label="{resourceManager.getString(
                                        'MainMenu', 'Person')}"
                            showEffect="{fadeIn}"
                            hideEffect="{fadeOut}" />
                        
                        <jn:OrderPage id="orderPage"
                            label="{resourceManager.getString(
                                        'MainMenu', 'Order')}"
                            showEffect="{fadeIn}"
                            hideEffect="{fadeOut}" />
                        
                        <jn:SupplyPage id="supplyPage"
                            label="{resourceManager.getString(
                                        'MainMenu', 'Supply')}"
                            showEffect="{fadeIn}"
                            hideEffect="{fadeOut}" />
                        
                        <jn:PaymentPage id="paymentPage"
                            label="{resourceManager.getString(
                                        'MainMenu', 'Payment')}"
                            showEffect="{fadeIn}"
                            hideEffect="{fadeOut}" />
                    </mx:ViewStack>
                </mx:target>
            </mx:AddChild>
            
            <mx:SetProperty
            	target="{mainMenu}"
                name="visible"
                value="true"/>
            
            <mx:SetProperty
            	target="{mainMenu}"
                name="includeInLayout"
                value="true"/>
        </mx:State>
        
        <mx:State name="loading">
            <mx:RemoveChild target="{loginPage}"/>
        </mx:State>
    </mx:states>
    
    <mx:Fade id="fadeOut"
        duration="1000"
        alphaFrom="1.0"
        alphaTo="0.0"/>
    
    <mx:Fade id="fadeIn"
        duration="1000"
        alphaFrom="0.0"
        alphaTo="1.0"/>
    
    <control:JNidController/>
    
    <mx:ApplicationControlBar id="mainMenu"
        dock="true"
        paddingTop="0"
        paddingBottom="0"
        paddingLeft="0"
        visible="false"
        includeInLayout="false">
        
        <mx:ToggleButtonBar
            dataProvider="{mainView}"
            firstButtonStyleName="squareBtn"
            lastButtonStyleName="squareBtn"/>
        
        <mx:Spacer
        	width="100%"/>
        
        <mx:LinkButton id="logOutBtn"
           label="{resourceManager.getString(
                        'MainMenu', 'LogOut')}"
           click="logOutBtnClick(event)"/>
    </mx:ApplicationControlBar>
    
    <jn:LoginPage id="loginPage" 
        width="100%"
        height="100%"/>
</mx:WindowedApplication>
